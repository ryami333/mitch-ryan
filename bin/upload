#!/usr/bin/env node

require('dotenv').config();

const AWS = require('aws-sdk');
const s3 = new AWS.S3({
    accessKeyId: process.env.S3_ACCESS_KEY_ID,
    secretAccessKey: process.env.S3_ACCESS_KEY_SECRET,
});
const options = {nodir: true};
const glob = require('glob');
const path = require('path');
const fs = require('fs');
const mime = require('mime');


glob("public/**/*", options, function (er, files) {
    files.forEach(function(sourceFile) {

        let data = fs.readFileSync(sourceFile);

        s3.putObject({
            Bucket: process.env.S3_BUCKET,
            Key: path.relative('public', sourceFile),
            ACL: 'public-read',
            Body: data,
            ContentDisposition: 'inline',
            ContentType: mime.lookup(sourceFile),
        }, function (res) {
            console.log('Successfully uploaded file.');
        });
    });
})

